{% extends "base.html" %}

{% block title %}–ê–≤—Ç–æ–ø–æ—Å—Ç—ã - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}
{% block page_title %}–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å—Ç—ã{% endblock %}

{% block content %}
<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-gradient-primary text-white">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <h5 class="text-white mb-2">
                            <i class="fas fa-clock me-2"></i>
                            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                        </h5>
                        <p class="text-white-75 mb-0">
                            –ü–æ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –≤ –∫–∞–Ω–∞–ª
                        </p>
                    </div>
                    <div class="col-auto">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="h4 text-white">üåÖ</div>
                                <div class="small text-white-75">09:00</div>
                                <div class="small text-white">–£—Ç—Ä–æ–º</div>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-white">‚òÄÔ∏è</div>
                                <div class="small text-white-75">14:00</div>
                                <div class="small text-white">–î–Ω–µ–º</div>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-white">üåÜ</div>
                                <div class="small text-white-75">19:00</div>
                                <div class="small text-white">–í–µ—á–µ—Ä–æ–º</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-templates me-2"></i>
                    –®–∞–±–ª–æ–Ω—ã –ø–æ—Å—Ç–æ–≤
                </h5>
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
                    <i class="fas fa-plus me-2"></i>
                    –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
                </button>
            </div>
            <div class="card-body">
                {% if templates %}
                    <div class="row">
                        {% for template in templates %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card h-100 {{ 'border-success' if template[5] else 'border-secondary' }}">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        {% if template[3] == 'greeting' %}
                                            <span class="badge bg-info">üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</span>
                                        {% elif template[3] == 'promotion' %}
                                            <span class="badge bg-warning">üî• –ê–∫—Ü–∏—è</span>
                                        {% elif template[3] == 'congratulation' %}
                                            <span class="badge bg-success">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
                                        {% endif %}
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                               {{ 'checked' if template[5] }}
                                               onchange="toggleTemplate({{ template[0] }}, this.checked)">
                                    </div>
                                </div>
                                
                                {% if template[4] %}
                                <img src="{{ template[4] }}" class="card-img-top" style="height: 150px; object-fit: cover;">
                                {% endif %}
                                
                                <div class="card-body">
                                    <h6 class="card-title">{{ template[1] }}</h6>
                                    <p class="card-text text-muted small">
                                        {{ template[2][:100] }}{% if template[2]|length > 100 %}...{% endif %}
                                    </p>
                                </div>
                                
                                <div class="card-footer bg-transparent">
                                    <div class="btn-group w-100">
                                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                                onclick="editTemplate({{ template[0] }})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" 
                                                onclick="sendNow({{ template[0] }})">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger btn-sm" 
                                                onclick="deleteTemplate({{ template[0] }})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-templates fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤</h5>
                        <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–æ–≤</p>
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
                            <i class="fas fa-plus me-2"></i>
                            –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
                </h5>
            </div>
            <div class="card-body">
                {% if stats %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–®–∞–±–ª–æ–Ω</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</th>
                                    <th>–û—à–∏–±–∫–∏</th>
                                    <th>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in stats %}
                                <tr>
                                    <td><strong>{{ stat[0] }}</strong></td>
                                    <td>
                                        {% if stat[1] == 'morning' %}üåÖ –£—Ç—Ä–æ–º
                                        {% elif stat[1] == 'afternoon' %}‚òÄÔ∏è –î–Ω–µ–º
                                        {% elif stat[1] == 'evening' %}üåÜ –í–µ—á–µ—Ä–æ–º
                                        {% else %}üì± –í—Ä—É—á–Ω—É—é
                                        {% endif %}
                                    </td>
                                    <td><span class="badge bg-success">{{ stat[2] }}</span></td>
                                    <td>
                                        {% if stat[3] > 0 %}
                                            <span class="badge bg-danger">{{ stat[3] }}</span>
                                        {% else %}
                                            <span class="badge bg-light text-dark">0</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% set success_rate = (stat[2] / (stat[2] + stat[3]) * 100) if (stat[2] + stat[3]) > 0 else 100 %}
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-{{ 'success' if success_rate >= 90 else 'warning' if success_rate >= 70 else 'danger' }}" 
                                                 style="width: {{ success_rate }}%">
                                                {{ "%.1f"|format(success_rate) }}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-chart-bar fa-2x text-muted mb-2"></i>
                        <p class="text-muted">–ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6>üì¢ –ö–∞–Ω–∞–ª –¥–ª—è –ø–æ—Å—Ç–æ–≤:</h6>
                    <code>-1002566537425</code>
                </div>
                
                <div class="mb-3">
                    <h6>‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:</h6>
                    <ul class="list-unstyled">
                        <li>üåÖ <strong>09:00</strong> - –£—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Å—Ç</li>
                        <li>‚òÄÔ∏è <strong>14:00</strong> - –î–Ω–µ–≤–Ω–æ–π –ø–æ—Å—Ç</li>
                        <li>üåÜ <strong>19:00</strong> - –í–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç</li>
                    </ul>
                </div>
                
                <div class="mb-3">
                    <h6>üìù –¢–∏–ø—ã —à–∞–±–ª–æ–Ω–æ–≤:</h6>
                    <ul class="list-unstyled">
                        <li>üëã <strong>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</strong> - –æ–±—ã—á–Ω—ã–µ –ø–æ—Å—Ç—ã</li>
                        <li>üî• <strong>–ê–∫—Ü–∏—è</strong> - –ø—Ä–æ–º–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã</li>
                        <li>üéâ <strong>–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</strong> - –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ</li>
                    </ul>
                </div>
                
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-info btn-sm" onclick="testConnection()">
                        <i class="fas fa-wifi me-1"></i>
                        –¢–µ—Å—Ç –∫–∞–Ω–∞–ª–∞
                    </button>
                    <button type="button" class="btn btn-outline-success btn-sm" onclick="location.reload()">
                        <i class="fas fa-sync-alt me-1"></i>
                        –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ -->
<div class="modal fade" id="createTemplateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>
                    –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –∞–≤—Ç–æ–ø–æ—Å—Ç–∞
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('create_template') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="template_title" class="form-label">
                            <i class="fas fa-heading me-1"></i>
                            –ó–∞–≥–æ–ª–æ–≤–æ–∫ *
                        </label>
                        <input type="text" class="form-control" id="template_title" name="title" 
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="template_content" class="form-label">
                            <i class="fas fa-align-left me-1"></i>
                            –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ *
                        </label>
                        <textarea class="form-control" id="template_content" name="content" rows="4" 
                                  placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..." required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="post_type" class="form-label">
                            <i class="fas fa-tag me-1"></i>
                            –¢–∏–ø –ø–æ—Å—Ç–∞ *
                        </label>
                        <select class="form-select" id="post_type" name="post_type" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="greeting">üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                            <option value="promotion">üî• –ê–∫—Ü–∏—è</option>
                            <option value="congratulation">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="template_image" class="form-label">
                            <i class="fas fa-image me-1"></i>
                            URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        </label>
                        <input type="url" class="form-control" id="template_image" name="image_url" 
                               placeholder="https://images.pexels.com/photos/...">
                    </div>
                    
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã -->
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-magic me-1"></i>
                            –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã
                        </label>
                        <div class="btn-group w-100" role="group">
                            <button type="button" class="btn btn-outline-info btn-sm" onclick="fillQuickTemplate('greeting')">
                                üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" onclick="fillQuickTemplate('promotion')">
                                üî• –ê–∫—Ü–∏—è
                            </button>
                            <button type="button" class="btn btn-outline-success btn-sm" onclick="fillQuickTemplate('congratulation')">
                                üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save me-2"></i>
                        –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal fade" id="editTemplateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('edit_template') }}">
                <div class="modal-body">
                    <input type="hidden" id="edit_template_id" name="template_id">
                    
                    <div class="mb-3">
                        <label for="edit_title" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                        <input type="text" class="form-control" id="edit_title" name="title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_content" class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ *</label>
                        <textarea class="form-control" id="edit_content" name="content" rows="4" required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_post_type" class="form-label">–¢–∏–ø –ø–æ—Å—Ç–∞ *</label>
                        <select class="form-select" id="edit_post_type" name="post_type" required>
                            <option value="greeting">üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                            <option value="promotion">üî• –ê–∫—Ü–∏—è</option>
                            <option value="congratulation">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_image" class="form-label">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="url" class="form-control" id="edit_image" name="image_url">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleTemplate(templateId, isActive) {
    fetch('/toggle_template', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `template_id=${templateId}&is_active=${isActive ? 1 : 0}`
    })
    .then(response => {
        if (response.ok) {
            showNotification('success', isActive ? '–®–∞–±–ª–æ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω' : '–®–∞–±–ª–æ–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
        } else {
            showNotification('error', '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
        }
    })
    .catch(error => {
        showNotification('error', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
    });
}

function sendNow(templateId) {
    if (confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç –ø–æ —ç—Ç–æ–º—É —à–∞–±–ª–æ–Ω—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?')) {
        fetch('/send_template_now', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `template_id=${templateId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('success', '–ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª!');
            } else {
                showNotification('error', `–û—à–∏–±–∫–∞: ${data.error}`);
            }
        })
        .catch(error => {
            showNotification('error', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
        });
    }
}

function editTemplate(templateId) {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞
    fetch(`/api/template/${templateId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('edit_template_id').value = templateId;
                document.getElementById('edit_title').value = data.template.title;
                document.getElementById('edit_content').value = data.template.content;
                document.getElementById('edit_post_type').value = data.template.post_type;
                document.getElementById('edit_image').value = data.template.image_url || '';
                
                const modal = new bootstrap.Modal(document.getElementById('editTemplateModal'));
                modal.show();
            } else {
                showNotification('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞');
            }
        })
        .catch(error => {
            showNotification('error', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        });
}

function deleteTemplate(templateId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        fetch('/delete_template', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `template_id=${templateId}`
        })
        .then(response => {
            if (response.ok) {
                showNotification('success', '–®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω');
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification('error', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        })
        .catch(error => {
            showNotification('error', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        });
    }
}

function fillQuickTemplate(type) {
    const templates = {
        'greeting': {
            title: '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!',
            content: '–ù–∞—á–Ω–∏—Ç–µ –¥–µ–Ω—å —Å –≤—ã–≥–æ–¥–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫!\n\nüõç –ù–æ–≤–∏–Ω–∫–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∂–¥—É—Ç –≤–∞—Å!\nüí∞ –õ—É—á—à–∏–µ —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!',
            image: 'https://images.pexels.com/photos/1002703/pexels-photo-1002703.jpeg'
        },
        'promotion': {
            title: '–ì–æ—Ä—è—á–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è!',
            content: '–ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è!\n\nüî• –°–∫–∏–¥–∫–∏ –¥–æ 50%\n‚ö° –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è\nüéØ –¢–æ–ª—å–∫–æ –ª—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã',
            image: 'https://images.pexels.com/photos/1303081/pexels-photo-1303081.jpeg'
        },
        'congratulation': {
            title: '–û—Ç–ª–∏—á–Ω–æ–≥–æ –¥–Ω—è!',
            content: '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±–∏—Ä–∞–µ—Ç–µ –Ω–∞—Å!\n\nüåü –í–∞—à–µ –¥–æ–≤–µ—Ä–∏–µ - –Ω–∞—à–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—è\nüíù –†–∞–±–æ—Ç–∞–µ–º –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞\nüöÄ –†–∞–∑–≤–∏–≤–∞–µ–º—Å—è –≤–º–µ—Å—Ç–µ —Å –≤–∞–º–∏',
            image: 'https://images.pexels.com/photos/1464625/pexels-photo-1464625.jpeg'
        }
    };
    
    const template = templates[type];
    if (template) {
        document.getElementById('template_title').value = template.title;
        document.getElementById('template_content').value = template.content;
        document.getElementById('post_type').value = type;
        document.getElementById('template_image').value = template.image;
    }
}

function testConnection() {
    fetch('/test_channel_connection')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('success', '–°–≤—è–∑—å —Å –∫–∞–Ω–∞–ª–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç!');
            } else {
                showNotification('error', `–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏: ${data.error}`);
            }
        })
        .catch(error => {
            showNotification('error', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏');
        });
}

function showNotification(type, message) {
    const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
    const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
    
    const alertHtml = `
        <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
             style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
            <i class="${icon} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', alertHtml);
    
    setTimeout(() => {
        const alert = document.querySelector('.alert');
        if (alert) {
            alert.remove();
        }
    }, 5000);
}
</script>

<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.text-white-75 {
    color: rgba(255, 255, 255, 0.75) !important;
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.form-check-input:checked {
    background-color: #28a745;
    border-color: #28a745;
}
</style>
{% endblock %}
{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}
{% block page_title %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-plus me-2"></i>
                    –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" id="addProductForm" novalidate>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="name" class="form-label">
                                    <i class="fas fa-tag me-1"></i>
                                    –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *
                                </label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 15 Pro" required>
                                <div class="invalid-feedback">
                                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞.
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">
                                    <i class="fas fa-align-left me-1"></i>
                                    –û–ø–∏—Å–∞–Ω–∏–µ
                                </label>
                                <textarea class="form-control" id="description" name="description" rows="3"
                                          placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">
                                            <i class="fas fa-dollar-sign me-1"></i>
                                            –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ *
                                        </label>
                                        <input type="number" class="form-control" id="price" name="price" 
                                               step="0.01" min="0" placeholder="99.99" required>
                                        <div class="invalid-feedback">
                                            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏.
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="cost_price" class="form-label">
                                            <i class="fas fa-coins me-1"></i>
                                            –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
                                        </label>
                                        <input type="number" class="form-control" id="cost_price" name="cost_price" 
                                               step="0.01" min="0" placeholder="50.00">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="category_id" class="form-label">
                                            <i class="fas fa-folder me-1"></i>
                                            –ö–∞—Ç–µ–≥–æ—Ä–∏—è *
                                        </label>
                                        <select class="form-select" id="category_id" name="category_id" required>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                            {% for category in categories %}
                                                <option value="{{ category[0] }}">
                                                    {{ category[3] }} {{ category[1] }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">
                                            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="stock" class="form-label">
                                            <i class="fas fa-boxes me-1"></i>
                                            –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ *
                                        </label>
                                        <input type="number" class="form-control" id="stock" name="stock" 
                                               min="0" placeholder="50" required>
                                        <div class="invalid-feedback">
                                            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="image_url" class="form-label">
                                    <i class="fas fa-image me-1"></i>
                                    URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                </label>
                                <input type="url" class="form-control" id="image_url" name="image_url" 
                                       placeholder="https://images.pexels.com/photos/...">
                                <div class="form-text">
                                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å Pexels –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-eye me-1"></i>
                                        –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="product-preview">
                                        <div class="text-center text-muted">
                                            <i class="fas fa-box fa-2x mb-2"></i>
                                            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-magic me-1"></i>
                                        –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="fillTemplate('electronics')">
                                            üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="fillTemplate('clothing')">
                                            üëï –û–¥–µ–∂–¥–∞
                                        </button>
                                        <button type="button" class="btn btn-outline-info btn-sm" onclick="fillTemplate('home')">
                                            üè† –î–æ–º –∏ —Å–∞–¥
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-2"></i>
                            –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                        <a href="{{ url_for('products') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            –û—Ç–º–µ–Ω–∞
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–∞
function updatePreview() {
    const name = document.getElementById('name').value.trim();
    const description = document.getElementById('description').value.trim();
    const price = document.getElementById('price').value.trim();
    const imageUrl = document.getElementById('image_url').value.trim();
    const stock = document.getElementById('stock').value.trim();
    const categorySelect = document.getElementById('category_id');
    const categoryName = categorySelect.options[categorySelect.selectedIndex]?.text || '';
    
    const previewDiv = document.getElementById('product-preview');
    
    if (name || price) {
        let preview = '<div class="text-center">';
        
        if (imageUrl) {
            preview += `<img src="${imageUrl}" alt="${name}" class="img-fluid rounded mb-2" style="max-height: 150px; object-fit: cover;">`;
        } else {
            preview += '<div class="bg-light rounded d-flex align-items-center justify-content-center mb-2" style="height: 150px;"><i class="fas fa-image fa-2x text-muted"></i></div>';
        }
        
        if (name) {
            preview += `<h6 class="fw-bold">${name}</h6>`;
        }
        
        if (description) {
            preview += `<p class="text-muted small">${description.substring(0, 100)}${description.length > 100 ? '...' : ''}</p>`;
        }
        
        if (price) {
            preview += `<div class="h5 text-success mb-2">$${price}</div>`;
        }
        
        if (categoryName && categoryName !== '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é') {
            preview += `<span class="badge bg-secondary">${categoryName}</span>`;
        }
        
        if (stock) {
            preview += `<div class="mt-2"><small class="text-muted">–í –Ω–∞–ª–∏—á–∏–∏: ${stock} —à—Ç.</small></div>`;
        }
        
        preview += '</div>';
        previewDiv.innerHTML = preview;
    } else {
        previewDiv.innerHTML = '<div class="text-center text-muted"><i class="fas fa-box fa-2x mb-2"></i><p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p></div>';
    }
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —à–∞–±–ª–æ–Ω–∞–º–∏
function fillTemplate(type) {
    const templates = {
        'electronics': {
            name: 'iPhone 15 Pro',
            description: '–ù–æ–≤–µ–π—à–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple —Å —á–∏–ø–æ–º A17 Pro, –∫–∞–º–µ—Ä–æ–π 48MP –∏ —Ç–∏—Ç–∞–Ω–æ–≤—ã–º –∫–æ—Ä–ø—É—Å–æ–º',
            price: '999.99',
            cost_price: '750.00',
            category_id: '1',
            stock: '25',
            image_url: 'https://images.pexels.com/photos/788946/pexels-photo-788946.jpeg'
        },
        'clothing': {
            name: '–§—É—Ç–±–æ–ª–∫–∞ Nike Dri-FIT',
            description: '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ –∏–∑ –¥—ã—à–∞—â–µ–π —Ç–∫–∞–Ω–∏ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',
            price: '29.99',
            cost_price: '15.00',
            category_id: '2',
            stock: '100',
            image_url: 'https://images.pexels.com/photos/8532616/pexels-photo-8532616.jpeg'
        },
        'home': {
            name: '–ö–æ—Ñ–µ–≤–∞—Ä–∫–∞ Delonghi',
            description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ñ–µ–≤–∞—Ä–∫–∞ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∫–æ—Ñ–µ–º–æ–ª–∫–æ–π –∏ –∫–∞–ø—É—á–∏–Ω–∞—Ç–æ—Ä–æ–º',
            price: '299.99',
            cost_price: '180.00',
            category_id: '3',
            stock: '15',
            image_url: 'https://images.pexels.com/photos/324028/pexels-photo-324028.jpeg'
        }
    };
    
    const template = templates[type];
    if (template) {
        document.getElementById('name').value = template.name;
        document.getElementById('description').value = template.description;
        document.getElementById('price').value = template.price;
        document.getElementById('cost_price').value = template.cost_price;
        document.getElementById('category_id').value = template.category_id;
        document.getElementById('stock').value = template.stock;
        document.getElementById('image_url').value = template.image_url;
        
        updatePreview();
    } else {
        console.warn(`–®–∞–±–ª–æ–Ω —Ç–∏–ø–∞ "${type}" –Ω–µ –Ω–∞–π–¥–µ–Ω.`);
    }
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã Bootstrap 5
(function () {
    'use strict'
    const form = document.getElementById('addProductForm');
    form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    }, false);
})();

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
['name', 'description', 'price', 'stock', 'category_id', 'image_url'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
        el.addEventListener('input', updatePreview);
        if (el.tagName === 'SELECT') {
            el.addEventListener('change', updatePreview);
        }
    }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', updatePreview);
</script>
{% endblock %}